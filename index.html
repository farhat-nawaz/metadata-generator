<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Metadata Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-50">
    <div class="max-w-4xl mx-auto p-6">
      <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h1 class="text-2xl font-bold text-indigo-700 mb-6 flex items-center">
          <i class="fas fa-file-code mr-3"></i>
          P28 Metadata Generator
        </h1>

        <form id="dataForm" class="space-y-6">
          <!-- Main Form Fields -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- UUID -->
            <div class="col-span-1">
              <label
                for="uuid"
                class="block text-sm font-medium text-gray-700 mb-1"
                >UUID</label
              >
              <div class="flex">
                <input
                  type="text"
                  id="uuid"
                  name="uuid"
                  class="flex-1 rounded-l-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                  placeholder="Auto-generated"
                />
                <button
                  type="button"
                  id="generateUUID"
                  class="bg-indigo-600 text-white px-3 py-2 rounded-r-md hover:bg-indigo-700 text-sm"
                >
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
            <!-- HFI ID -->
            <div class="col-span-1">
              <label
                for="hfi_id"
                class="block text-sm font-medium text-gray-700 mb-1"
                >HFI ID</label
              >
              <input
                type="text"
                id="hfi_id"
                name="hfi_id"
                class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                placeholder="xxxx-xxx-xxx"
              />
            </div>
            <!-- Language -->
            <div class="col-span-1">
              <label
                for="language"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Language</label
              >
              <select
                id="language"
                name="language"
                class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
              >
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
                <option value="rust">Rust</option>
              </select>
            </div>
            <!-- Interface -->
            <div class="col-span-1">
              <label
                for="interface"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Interface</label
              >
              <select
                id="interface"
                name="interface"
                class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
              >
                <option value="pr_writer">PR Writer</option>
                <option value="code_generator">Code Generator</option>
                <option value="code_reviewer">Code Reviewer</option>
              </select>
            </div>
            <!-- Starting Commit Hash -->
            <div class="col-span-1">
              <label
                for="starting_commit__hash"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Starting Commit Hash</label
              >
              <input
                type="text"
                id="starting_commit__hash"
                name="starting_commit__hash"
                class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                placeholder="Git commit hash"
              />
            </div>
            <!-- Jira -->
            <div class="col-span-1">
              <label
                for="jira"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Jira</label
              >
              <input
                type="text"
                id="jira"
                name="jira"
                class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                placeholder="ANTHS-xxxx"
              />
            </div>
            <!-- Root GDrive -->
            <div class="col-span-2">
              <label
                for="root_gdrive"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Root GDrive</label
              >
              <input
                type="text"
                id="root_gdrive"
                name="root_gdrive"
                class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                placeholder="GDrive link"
              />
            </div>
          </div>

          <!-- Repository Section -->
          <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
            <h2 class="text-lg font-medium text-gray-800 mb-4">
              Repository Information
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Repo Link -->
              <div class="col-span-2">
                <label
                  for="repo_link"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Repository Link</label
                >
                <input
                  type="text"
                  id="repo_link"
                  name="repo_link"
                  class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                  placeholder="https://github.com/..."
                />
              </div>
              <!-- Codebase Category -->
              <div class="col-span-1">
                <label
                  for="codebase_category"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Codebase Category</label
                >
                <select
                  id="codebase_category"
                  name="codebase_category"
                  class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                >
                  <option value="small">Small</option>
                  <option value="large">Large</option>
                </select>
              </div>
              <!-- Repo Type -->
              <div class="col-span-1">
                <label
                  for="repo_type"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Repository Type</label
                >
                <select
                  id="repo_type"
                  name="repo_type"
                  class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                >
                  <option value="application">Application</option>
                  <option value="library">Library</option>
                  <option value="sdk">SDK</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Prompts Section -->
          <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-medium text-gray-800">Prompts</h2>
              <button
                type="button"
                id="addPrompt"
                class="bg-indigo-600 text-white px-3 py-1 rounded-md hover:bg-indigo-700 text-sm flex items-center"
              >
                <i class="fas fa-plus mr-1"></i> Add Prompt
              </button>
            </div>

            <div id="prompts-container">
              <!-- Prompt template - will be duplicated by JS -->
              <div
                class="prompt-item mb-6 bg-white p-4 rounded-md border border-gray-200 shadow-sm"
              >
                <div class="flex justify-between items-center mb-3">
                  <h3 class="text-md font-medium text-gray-700">Prompt #1</h3>
                  <button
                    type="button"
                    class="remove-prompt text-red-500 hover:text-red-700"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div class="col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Prompt Text</label
                    >
                    <textarea
                      name="prompts[0][prompt]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                      rows="3"
                      placeholder="Enter prompt text"
                    ></textarea>
                  </div>
                  <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Response Time (seconds)</label
                    >
                    <input
                      type="number"
                      name="prompts[0][response_time_seconds]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                      value="1"
                    />
                  </div>
                  <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >PDF Link</label
                    >
                    <input
                      type="text"
                      name="prompts[0][pdf_link]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                      placeholder="Link to PDF"
                    />
                  </div>
                  <div class="col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Final Codebase Link</label
                    >
                    <input
                      type="text"
                      name="prompts[0][final_codebase_link]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                      placeholder="Link to final codebase"
                    />
                  </div>
                  <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Use Case</label
                    >
                    <select
                      name="prompts[0][usecase]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                    >
                      <option value="feature_implementation">
                        Feature Implementation
                      </option>
                      <option value="bug_fix">Bug Fix</option>
                      <option value="refactoring">Refactoring</option>
                      <option value="optimization">Optimization</option>
                    </select>
                  </div>
                  <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Issue Type</label
                    >
                    <select
                      name="prompts[0][issue_type]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                    >
                      <option value="technical_inconsistency">
                        Technical Inconsistency
                      </option>
                      <option value="functional_bug">Functional Bug</option>
                      <option value="security_vulnerability">
                        Security Vulnerability
                      </option>
                      <option value="performance_issue">
                        Performance Issue
                      </option>
                    </select>
                  </div>
                  <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Choice</label
                    >
                    <input
                      type="number"
                      name="prompts[0][choice]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                      value="0"
                    />
                  </div>
                  <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Level of Correctness</label
                    >
                    <input
                      type="number"
                      name="prompts[0][level_of_correctness]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                      value="-1"
                    />
                  </div>
                  <div class="col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Build Creator</label
                    >
                    <input
                      type="text"
                      name="prompts[0][build_creator]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                      value="default"
                    />
                  </div>
                  <div class="col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1"
                      >Comment</label
                    >
                    <textarea
                      name="prompts[0][comment]"
                      class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 bg-gray-50 p-2 w-full text-sm"
                      rows="3"
                      required
                      placeholder="Enter a meaningful evaluation comment"
                    ></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex justify-end space-x-4">
            <button
              type="button"
              id="resetForm"
              class="bg-white text-gray-700 border border-gray-300 px-4 py-2 rounded-md hover:bg-gray-50 flex items-center"
            >
              <i class="fas fa-undo mr-2"></i> Reset
            </button>
            <button
              type="button"
              id="viewJson"
              class="bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-800 flex items-center"
            >
              <i class="fas fa-code mr-2"></i> Get JSON
            </button>
          </div>
        </form>
      </div>

      <!-- JSON Output Modal -->
      <div
        id="jsonModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
      >
        <div
          class="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-auto"
        >
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-800">JSON Output</h2>
            <button id="closeModal" class="text-gray-500 hover:text-gray-700">
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>
          <div class="bg-gray-900 rounded-lg p-4 overflow-auto max-h-[60vh]">
            <pre
              id="jsonOutput"
              class="text-green-400 text-sm whitespace-pre-wrap"
            ></pre>
          </div>
          <div class="mt-4 flex justify-end">
            <button
              id="copyJson"
              class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 flex items-center"
            >
              <i class="fas fa-copy mr-2"></i> Copy JSON
            </button>
          </div>
        </div>
      </div>

      <!-- Toast Notification -->
      <div
        id="toast"
        class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-md shadow-lg hidden z-50 flex items-center"
      >
        <i class="fas fa-check-circle mr-2"></i>
        <span id="toastMessage">Success!</span>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Elements
        const dataForm = document.getElementById("dataForm");
        const promptsContainer = document.getElementById("prompts-container");
        const addPromptButton = document.getElementById("addPrompt");
        const resetFormButton = document.getElementById("resetForm");
        const viewJsonButton = document.getElementById("viewJson");
        const generateUUIDButton = document.getElementById("generateUUID");
        const jsonModal = document.getElementById("jsonModal");
        const jsonOutput = document.getElementById("jsonOutput");
        const closeModalButton = document.getElementById("closeModal");
        const copyJsonButton = document.getElementById("copyJson");
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");

        let promptCount = 1;

        // Function to generate UUID
        function generateUUID() {
          return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
            /[xy]/g,
            function (c) {
              const r = (Math.random() * 16) | 0;
              const v = c === "x" ? r : (r & 0x3) | 0x8;
              return v.toString(16);
            },
          );
        }

        // Function to show toast
        function showToast(message, type = "success") {
          toastMessage.textContent = message;
          toast.classList.remove("hidden", "bg-green-600", "bg-red-600");

          if (type === "success") {
            toast.classList.add("bg-green-600");
          } else {
            toast.classList.add("bg-red-600");
          }

          toast.classList.remove("hidden");

          // Auto-hide after 3 seconds
          setTimeout(() => {
            toast.classList.add("hidden");
          }, 3000);
        }

        // Add new prompt
        addPromptButton.addEventListener("click", function () {
          promptCount++;

          const promptTemplate = promptsContainer
            .querySelector(".prompt-item")
            .cloneNode(true);
          const promptHeader = promptTemplate.querySelector("h3");
          promptHeader.textContent = `Prompt #${promptCount}`;

          // Update input names to have the correct index
          const inputs = promptTemplate.querySelectorAll(
            "input, textarea, select",
          );
          inputs.forEach((input) => {
            if (input.name) {
              input.name = input.name.replace(
                /prompts\[\d+\]/,
                `prompts[${promptCount - 1}]`,
              );
              input.value = ""; // Clear value except for defaults
            }
          });

          // Set default values
          promptTemplate.querySelector(
            'input[name$="[response_time_seconds]"]',
          ).value = "1";
          promptTemplate.querySelector('input[name$="[choice]"]').value = "0";
          promptTemplate.querySelector(
            'input[name$="[level_of_correctness]"]',
          ).value = "-1";
          promptTemplate.querySelector('input[name$="[build_creator]"]').value =
            "default";

          // Add remove handler
          const removeButton = promptTemplate.querySelector(".remove-prompt");
          removeButton.addEventListener("click", function () {
            promptTemplate.remove();
            updatePromptNumbers();
          });

          promptsContainer.appendChild(promptTemplate);
        });

        // Remove prompt
        document.addEventListener("click", function (e) {
          if (
            e.target.classList.contains("remove-prompt") ||
            e.target.closest(".remove-prompt")
          ) {
            const promptItem = e.target.closest(".prompt-item");

            // Don't remove if it's the only prompt
            if (promptsContainer.querySelectorAll(".prompt-item").length > 1) {
              promptItem.remove();
              updatePromptNumbers();
            } else {
              showToast("Cannot remove the only prompt", "error");
            }
          }
        });

        // Update prompt numbers
        function updatePromptNumbers() {
          const promptItems = promptsContainer.querySelectorAll(".prompt-item");
          promptItems.forEach((item, index) => {
            const promptHeader = item.querySelector("h3");
            promptHeader.textContent = `Prompt #${index + 1}`;

            const inputs = item.querySelectorAll("input, textarea, select");
            inputs.forEach((input) => {
              if (input.name) {
                input.name = input.name.replace(
                  /prompts\[\d+\]/,
                  `prompts[${index}]`,
                );
              }
            });
          });

          promptCount = promptItems.length;
        }

        // Generate UUID
        generateUUIDButton.addEventListener("click", function () {
          document.getElementById("uuid").value = generateUUID();
        });

        // Form submit handler
        dataForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const formData = getFormData();
          console.log("Form submitted:", formData);
          showToast("Form submitted successfully!");
        });

        // View JSON button handler
        viewJsonButton.addEventListener("click", function () {
          const formData = getFormData();
          jsonOutput.textContent = JSON.stringify(formData, null, 2);
          jsonModal.classList.remove("hidden");
        });

        // Close modal button handler
        closeModalButton.addEventListener("click", function () {
          jsonModal.classList.add("hidden");
        });

        // Close modal when clicking outside
        jsonModal.addEventListener("click", function (e) {
          if (e.target === jsonModal) {
            jsonModal.classList.add("hidden");
          }
        });

        // Copy JSON button handler
        copyJsonButton.addEventListener("click", function () {
          const jsonText = jsonOutput.textContent;
          navigator.clipboard
            .writeText(jsonText)
            .then(() => {
              showToast("JSON copied to clipboard!");
            })
            .catch(() => {
              showToast("Failed to copy JSON", "error");
            });
        });

        // Reset form button handler
        resetFormButton.addEventListener("click", function () {
          if (confirm("Are you sure you want to reset the form?")) {
            dataForm.reset();

            // Remove extra prompts
            const promptItems =
              promptsContainer.querySelectorAll(".prompt-item");
            for (let i = promptItems.length - 1; i > 0; i--) {
              promptItems[i].remove();
            }

            promptCount = 1;
            updatePromptNumbers();
            showToast("Form has been reset");
          }
        });

        // Function to get form data as JSON
        function getFormData() {
          const formData = {
            uuid: document.getElementById("uuid").value,
            hfi_id: document.getElementById("hfi_id").value,
            language: document.getElementById("language").value,
            interface: document.getElementById("interface").value,
            starting_commit__hash: document.getElementById(
              "starting_commit__hash",
            ).value,
            jira: document.getElementById("jira").value,
            root_gdrive: document.getElementById("root_gdrive").value,
            repo: {
              repo_link: document.getElementById("repo_link").value,
              codebase_category:
                document.getElementById("codebase_category").value,
              repo_type: document.getElementById("repo_type").value,
            },
            prompts: [],
          };

          // Get prompt data
          const promptItems = promptsContainer.querySelectorAll(".prompt-item");
          promptItems.forEach((item, index) => {
            const promptData = {
              prompt: item.querySelector('textarea[name$="[prompt]"]').value,
              response_time_seconds:
                parseInt(
                  item.querySelector('input[name$="[response_time_seconds]"]')
                    .value,
                ) || 1,
              pdf_link: item.querySelector('input[name$="[pdf_link]"]').value,
              final_codebase_link: item.querySelector(
                'input[name$="[final_codebase_link]"]',
              ).value,
              usecase: item.querySelector('select[name$="[usecase]"]').value,
              issue_type: item.querySelector('select[name$="[issue_type]"]')
                .value,
              choice:
                parseInt(item.querySelector('input[name$="[choice]"]').value) ||
                0,
              level_of_correctness:
                parseInt(
                  item.querySelector('input[name$="[level_of_correctness]"]')
                    .value,
                ) || -1,
              build_creator:
                item.querySelector('input[name$="[build_creator]"]').value ||
                "default",
              comment: item.querySelector('input[name$="[comment]"]').value,
            };

            formData.prompts.push(promptData);
          });

          return formData;
        }
      });
    </script>
  </body>
</html>
